######################################################################
#                    MAIN CONFIGURATION SETTINGS                     #
######################################################################

# LDAP server to use for main lookups
LDAPSERVER=ldap://ldap.local:389
LDAPBASE=dc=tika,dc=stderr,dc=nl
LDAPURL=LDAPSERVER/LDAPBASE

# For all intents and purposes (and mostly how the outside world sees us), we
# are tika, not mail.local. This is used for qualifying addresses, in received
# headers, in HELO commands, etc.
primary_hostname = tika.stderr.nl

# List of domains for which full e-mail addresses are configured on the LDAP
# directory. This list is taken from LDAP as well. Since an ldapm query
# returns results separated with newlines, we change the list separator to
# newline for this list.
domainlist virtual_domains = <\n ${lookup ldapm {LDAPURL?domainName?sub?(objectClass=maroesjaDomain)}}
# List of real hosts for which we deliver mail to real users.
domainlist real_domains = *.tika.stderr.nl : tika.stderr.nl
# The list of domains for which we handle mail ourselves
domainlist local_domains = +virtual_domains : +real_domains

# List of recipient domains to relay _to_. Use this list if you're -
# for example - fallback MX or mail gateway for domains.
domainlist relay_to_domains = 

# Relay messages for all other containers and the host.
hostlist relay_from_hosts = 10.42.0.0/24 : 127.0.0.1

# Hosts that are known to run fetchmail or similar forwarding services that do
# not benefit from extensive checking.
# We use the primary address of login.local here (also used for outgoing SMTP),
# since avahi seems to resolve an arbitrary one (so writing "login.local" will
# fail).
hostlist fetchmail_hosts = 10.42.0.16

# Don't reject spam from these hosts, since they are known dumb, but trusted
# relays. They will only send rejects to the wrong people.
hostlist dont_reject_spam_hosts = *.utsp.utwente.nl : *.snt.utwente.nl : *.spullenmannen.nl : 10.42.0.0/24

# The gecos field in /etc/passwd holds not only the name. see passwd(5).
gecos_pattern = ^([^,:]*)
gecos_name = $1

# Defines the access control list that is run when an
# SMTP MAIL command is received.
acl_smtp_mail = acl_check_mail
# Defines the access control list that is run when an
# SMTP RCPT command is received.
acl_smtp_rcpt = acl_check_rcpt
# Defines the access control list that is run when an
# SMTP DATA command is received.
acl_smtp_data = acl_check_data

spamd_address = /var/run/spamd.socket

# Do a reverse DNS lookup on all incoming IP calls, in order to get the
# true host name.
host_lookup = *

# Queue handling
#
# Drop undeliverable bounces after this time
ignore_bounce_errors_after = 2d
# Bounce frozen messages after this time
timeout_frozen_after = 7d
# Tell postmaster about freezing
freeze_tell = postmaster
# Define spool directory
spool_directory = /var/spool/exim4
# When a message is delayed, send out a warning after 4 hours, one after 48
# hours and no more after that.
delay_warning = 4h:48h:99d

# Log subjects, for easy tracing of messages and peer dn on TLS connections.
# Don't log complete headers on rejects, that clutters the log.
log_selector = +subject +tls_peerdn +tls_certificate_verified -rejected_header

# Listen on the default SMTP port, but also on 465 (SMTPS) and 587 (SMTP
# submission) so clients can use other ports for submission (since ISPs
# commonly block port 25 outgoing).
daemon_smtp_ports = 25 : 465 : 587

# Do not keep any environment variables when exim is ran, to prevent security
# issues (this is the default since CVE-2016-1531, but making the default
# explicit in the config prevents a warning about the changed default).
keep_environment =

# vim: set sts=2 expandtab sw=2 ai:
